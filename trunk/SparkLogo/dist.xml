<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="universal-dist" name="Compiler">
	<description>
                This Ant dist.xml file is used to create the distributions of
                the SPARK Language
        </description>

	<!-- Location of the source code folder -->
	<property location="src" name="src" />
	<!-- Release folder -->
	<property location="release" name="release" />
	<!-- Distribution folder -->
	<property location="release/dist" name="dist" />
	<!-- Archive of all distributions -->
	<property name="dist-archive" location="dist" />

	<!-- SPARK folder -->
	<property name="spark" location="../Spark" />
	<!-- SPARK release folder -->
	<property name="spark-release" location="${spark}/release" />
	<!-- SPARK library folder -->
	<property name="spark-lib" location="${spark}/lib" />
	<!-- SPARK docs release folder -->
	<property name="spark-docs" location="../SPARK Docs/output" />

	<tstamp />

	<!-- Version number -->
	<property name="version" value="1.1a" />

	<!-- Windows distribution name -->
	<property name="win-name" value="SPARK_${version}_windows" />
	<!-- MacOS distribution name -->
	<property name="mac-name" value="SPARK_${version}_mac" />
	<!-- Universal distribution name -->
	<property name="universal-name" value="SPARK_${version}_universal" />


	<!-- Source code, text files, and scripts -->
	<fileset dir="${basedir}" id="basic-files">
		<include name="LICENSE" />
		<include name="README" />
		<include name="Licenses/**/**" />
		<include name="build.xml" />
		<include name="spark.log4j.properties" />

		<include name="logo/commands.xml" />
		<include name="logo/SparkTypes.xml" />
	</fileset>

	<!-- Samples -->
	<fileset dir="${basedir}" id="samples">
		<include name="samples/**/**" />
		<include name="samples/**/output/*.xml" />
		<include name="samples/**/output/*.png" />
		<exclude name="samples/**/output/*/*" />
	</fileset>

	<!-- Libraries -->
	<fileset dir="${basedir}" id="libs">
		<include name="lib/*.jar" />
	</fileset>

	<!-- Documents -->
	<zipfileset dir="${spark-docs}" id="docs" prefix="docs">
		<include name="SPARK-PL*" />
	</zipfileset>


	<!-- Target: init -->
	<target name="init" description="Creates output folders">
		<mkdir dir="${dist}" />
	</target>


	<!-- Target: universal-dist -->
	<target name="universal-dist" depends="init" description="Creates Universal distribution">
		<zip destfile="${dist}/${universal-name}.zip">
			<fileset refid="basic-files" />
			<zipfileset dir="${spark}/licenses" prefix="licenses">
				<include name="**/**" />
			</zipfileset>

			<fileset refid="libs" />
			<zipfileset dir="${spark}" prefix="lib">
				<include name="README" />
				<include name="LICENSE" />
				<include name="BatchRunner.properties"/>
			</zipfileset>

			<zipfileset refid="docs" />

			<zipfileset dir="${spark-lib}" prefix="lib">
				<include name="*.jar" />
				<exclude name="p2pmpi*" />
				<exclude name="pj*" />
			</zipfileset>

			<zipfileset dir="${spark-release}" prefix="lib">
				<include name="spark.jar" />
				<include name="spark-server.bat" />
				<include name="spark-client.bat" />
				<include name="spark-batches.bat" />
			</zipfileset>

			<zipfileset dir="${basedir}/logo">
				<include name="spark-config.xml" />
				<include name="config.xml" />
			</zipfileset>

			<zipfileset dir="${spark-lib}">
				<include name="logo.jpg" />
			</zipfileset>

			<zipfileset dir="${release}">
				<include name="*.jar" />
			</zipfileset>

			<fileset refid="samples" />
		</zip>

		<copy tofile="${dist-archive}/${universal-name}-${DSTAMP}.zip">
			<fileset dir="${dist}">
				<include name="${universal-name}.zip" />
			</fileset>
		</copy>
	</target>



	<!-- Target: win-dist -->
	<target name="win-dist" depends="init" description="Creates Windows distribution">
		<zip destfile="${dist}/${win-name}.zip">
			<fileset refid="basic-files" />
			<zipfileset dir="${spark}/Licenses" prefix="licenses">
				<include name="**/**" />
			</zipfileset>

			<fileset refid="libs" />
			<zipfileset dir="${spark}" prefix="lib">
				<include name="README" />
				<include name="LICENSE" />
				<include name="BatchRunner.properties"/>
			</zipfileset>

			<zipfileset refid="docs" />

			<zipfileset dir="${spark-lib}" prefix="lib">
				<include name="*.jar" />
				<exclude name="p2pmpi*" />
				<exclude name="pj*" />
			</zipfileset>

			<zipfileset dir="${spark-release}" prefix="lib">
				<include name="spark.jar" />
				<include name="spark-server.bat" />
				<include name="spark-client.bat" />
				<include name="spark-batches.bat" />
			</zipfileset>
			
			<zipfileset dir="${basedir}/logo">
				<include name="spark-config.xml" />
				<include name="config.xml" />
			</zipfileset>

			<zipfileset dir="${spark-lib}">
				<include name="logo.jpg" />
			</zipfileset>

			<zipfileset dir="${release}">
				<include name="*.jar" />
				<include name="*.dll" />
				<include name="*.bat" />
			</zipfileset>


			<zipfileset dir="${spark-release}" prefix="">
				<include name="*.dll" />
			</zipfileset>

			<fileset refid="samples" />
		</zip>


		<copy tofile="${dist-archive}/${win-name}-${DSTAMP}.zip">
			<fileset dir="${dist}">
				<include name="${win-name}.zip" />
			</fileset>
		</copy>
	</target>

	
	
	<!-- Target: mac-dist -->
	<target name="mac-dist" depends="init" description="Creates MacOS distribution">
		<zip destfile="${dist}/${mac-name}.zip">
			<fileset refid="basic-files" />
			<zipfileset dir="${spark}/Licenses" prefix="licenses">
				<include name="**/**" />
			</zipfileset>

			<fileset refid="libs" />
			<zipfileset dir="${spark}" prefix="lib">
				<include name="README" />
				<include name="LICENSE" />
				<include name="BatchRunner.properties"/>
			</zipfileset>

			<zipfileset refid="docs" />

			<zipfileset dir="${spark-lib}" prefix="lib">
				<include name="*.jar" />
				<exclude name="p2pmpi*" />
				<exclude name="pj*" />
			</zipfileset>

			<zipfileset dir="${spark-release}" prefix="lib">
				<include name="spark.jar" />
			</zipfileset>
			
			<zipfileset dir="${basedir}/logo">
				<include name="spark-config.xml" />
				<include name="config.xml" />
			</zipfileset>

			<zipfileset dir="${spark-lib}">
				<include name="logo.jpg" />
			</zipfileset>

			<zipfileset dir="${release}">
				<include name="*.jar" />
				<include name="*.jnilib" />
			</zipfileset>


			<zipfileset dir="${spark-release}" prefix="">
				<include name="*.jnilib" />
			</zipfileset>

			<fileset refid="samples" />
		</zip>


		<copy tofile="${dist-archive}/${mac-name}-${DSTAMP}.zip">
			<fileset dir="${dist}">
				<include name="${mac-name}.zip" />
			</fileset>
		</copy>
	</target>

	

	<target name="all" depends="universal-dist,win-dist,mac-dist">
	</target>


	<!-- Target: clean -->
	<target name="clean" description="Removes all output files">
		<delete dir="${dist}" />
	</target>
</project>